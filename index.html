<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Bicycle Connectivity Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />
<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }

#map-overlay {
  position:absolute;
  top:10px;
  left:10px;
  background: rgba(255,255,255,0.95);
  padding:12px 16px;
  border-radius:8px;
  font-family:"DIN Pro","Arial",sans-serif;
  color:black;
  z-index:2;
  max-width:300px;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
  transition: transform 0.3s ease, opacity 0.3s ease;
}

#menu-button {
  display:none;
  align-items:center;
  gap:8px;
  font-family:"DIN Pro","Arial",sans-serif;
}

/* Hamburger icon */
.menu-icon {
  display:inline-block;
  width:18px;
  height:14px;
  position:relative;
}
.menu-icon span {
  position:absolute;
  height:2px;
  width:100%;
  background:black;
  left:0;
  transition:0.3s;
}
.menu-icon span:nth-child(1){top:0;}
.menu-icon span:nth-child(2){top:6px;}
.menu-icon span:nth-child(3){top:12px;}
.menu-icon.active span:nth-child(1){transform:rotate(45deg); top:6px;}
.menu-icon.active span:nth-child(2){opacity:0;}
.menu-icon.active span:nth-child(3){transform:rotate(-45deg); top:6px;}

#map-title { font-size:20px; margin:0 0 10px 0; font-weight:bold; }
#legend { margin-top:10px; font-size:13px; }
.gradient-bar { height:18px; width:200px; border:1px solid #999; margin-bottom:4px; }
.legend-labels { display:flex; justify-content:space-between; width:200px; font-size:12px; margin-left:0; }
#style-switcher { margin-top:12px; font-size:14px; }
#style-switcher strong { display:block; margin-top:6px; }
#style-switcher label { display:flex; align-items:flex-start; gap:8px; cursor:pointer; margin-bottom:18px; line-height:1.25; }
#style-switcher input[type="radio"] { margin-top:4px; flex:0 0 auto; width:16px; height:16px; }
#style-switcher label > span { display:block; flex:1 1 0; }
#style-switcher label.main-group-label > span { font-weight:bold; font-size:14px; }
.suboptions { margin-left:28px; margin-top:6px; display:none; }
.suboptions label { display:flex; align-items:flex-start; gap:8px; line-height:1.25; margin-bottom:10px; }
.suboptions label > span { font-size:13px; font-weight:normal; }

/* Description box */
#description-box {
  position:absolute;
  bottom:10px;
  left:10px;
  width:360px;
  background: rgba(255,255,255,0.95);
  padding:12px 16px;
  border-radius:8px;
  font-family:"DIN Pro","Arial",sans-serif;
  color:black;
  z-index:2;
  font-size:13px;
  line-height:1.4;
  overflow-wrap:break-word;
  white-space:normal;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
}
.mapboxgl-ctrl-bottom-left { display:none; }

/* MOBILE STYLING */
@media (max-width:768px){
  #map-overlay {
    display:none;
    top:60px;
    left:10px;
    right:10px;
    width:auto;
    max-width:unset;
    font-size:14px;
    z-index:3;
    transform: translateY(-10px);
    opacity:0;
  }
  #map-overlay.open {
    display:block;
    transform: translateY(0);
    opacity:1;
  }
  #menu-button{
    display:flex;
    position:absolute;
    top:10px;
    left:10px;
    z-index:4;
    background:rgba(255,255,255,0.7);
    border:1px solid #999;
    border-radius:5px;
    padding:6px 12px;
    font-size:14px;
    cursor:pointer;
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
  }
  #description-box{width:calc(100% - 40px); left:10px; right:30px; bottom:10px; font-size:12px; padding:10px;}
  .legend-labels{font-size:11px;}
  .suboptions{margin-left:16px; font-size:12px;}
}
</style>
</head>
<body>

<div id="map"></div>

<!-- MOBILE MENU BUTTON -->
<button id="menu-button">
  <span class="menu-icon"><span></span><span></span><span></span></span>
  <span class="menu-text">Menu</span>
</button>

<!-- SIDEBAR -->
<div id="map-overlay">
  <div id="map-title">Cycling Connectivity Melbourne</div>
  <div id="legend"></div>
  <div id="style-switcher">
    <strong>Choose Layer:</strong>

    <!-- Group 1 -->
    <label class="main-group-label"><input type="radio" name="layer-group" value="importance" checked><span>Importance of link to Network</span></label>
    <div id="betweenness-suboptions" class="suboptions">
      <label><input type="radio" name="betweenness-sub" id="unfactored" checked><span>Existing network</span></label>
      <label><input type="radio" name="betweenness-sub" id="factored"><span>Change to link importance when infrastructure is considered</span></label>
      <label><input type="radio" name="betweenness-sub" id="difference"><span>Change to link importance when upgrade are applied</span></label>
    </div>

    <!-- Group 2 -->
    <label class="main-group-label"><input type="radio" name="layer-group" value="access"><span>Access to Ideal Trip Options</span></label>
    <div id="choropleth-suboptions" class="suboptions">
      <label><input type="radio" name="choropleth-sub" id="choropleth-existing" checked><span>Existing network</span></label>
      <label><input type="radio" name="choropleth-sub" id="choropleth-improvements"><span>With improvements</span></label>
      <label><input type="radio" name="choropleth-sub" id="choropleth-change"><span>Change from improvements</span></label>
    </div>

    <!-- Group 3 -->
    <label class="main-group-label"><input type="radio" name="layer-group" value="weighting"><span>Weighting of Link Attributes</span></label>
    <div id="weighting-suboptions" class="suboptions">
      <label><input type="radio" name="weighting-sub" id="weighting-existing" checked><span>Existing network</span></label>
      <label><input type="radio" name="weighting-sub" id="weighting-improvements"><span>With improvements</span></label>
      <label><input type="radio" name="weighting-sub" id="weighting-change"><span>Change from improvements</span></label>
    </div>

    <!-- Group 4 -->
    <label class="main-group-label"><input type="radio" name="layer-group" value="riderTypes"><span>Cyclists Types and where they are comfortable cycling</span></label>
    <div id="rider-suboptions" class="suboptions">
      <label><input type="checkbox" name="riderType" value="rider_strong" checked><span><div style="display:flex;align-items:center;margin-bottom:4px;"><div style="width:20px;height:10px;background-color:rgb(245,133,5);margin-right:8px;"></div><span>Strong and Fearless</span></div></span></label>
      <label><input type="checkbox" name="riderType" value="rider_confident" checked><span><div style="display:flex;align-items:center;margin-bottom:4px;"><div style="width:20px;height:10px;background-color:rgb(167,21,193);margin-right:8px;"></div><span>Enthused and Confident</span></div></span></label>
      <label><input type="checkbox" name="riderType" value="rider_concerned" checked><span><div style="display:flex;align-items:center;margin-bottom:4px;"><div style="width:20px;height:10px;background-color:rgb(27,163,254);margin-right:8px;"></div><span>Interested but Concerned</span></div></span></label>
      <label><input type="checkbox" name="riderType" value="rider_noway" checked><span><div style="display:flex;align-items:center;"><div style="width:20px;height:10px;background-color:rgb(0,189,0);margin-right:8px;"></div><span>No Way No How</span></div></span></label>
    </div>
  </div>
</div>

<div id="description-box"><strong>About:</strong> This dashboard visualises bicycle network connectivity across Melbourne.</div>

<script>
mapboxgl.accessToken='pk.eyJ1IjoiYm1lbiIsImEiOiJjbWZtMGQwc28wMmJlMnFvZWNjaXY5eW03In0.Su60i1Xyh3ejDhmiJf2NCg';

const styles = {
  'choropleth-existing': 'mapbox://styles/bmen/cmfb3otgq004001ss00ri10ue', /* ---------- FINAL ---------- */
  'choropleth-improvements': 'mapbox://styles/bmen/cmfb3otgq004001ss00ri10ue', /* ---------- PLACEHOLDER ---------- */
  'choropleth-change': 'mapbox://styles/bmen/cmfb3otgq004001ss00ri10ue', /* ---------- PLACEHOLDER ---------- */
  'weighting-existing': 'mapbox://styles/bmen/cmgulnyh9002d01r5bt6x5k71', /* ---------- FINAL ---------- */
  'weighting-improvements': 'mapbox://styles/bmen/cmgukkhik002q01sr1u8j0bqh', /* ---------- FINAL ---------- */
  'weighting-change': 'mapbox://styles/bmen/cmgue4s9c001y01r502n92t05', /* ---------- FINAL ---------- */
  'unfactored': 'mapbox://styles/bmen/cmgvgr5pj004001t1afeo8sqa', /* ---------- FINAL ---------- */
  'factored': 'mapbox://styles/bmen/cmgvnyosh003r01stgrll4y99', /* ---------- FINAL ---------- */
  'difference': 'mapbox://styles/bmen/cmfl1xxvg006t01srbsulf23b', /* ---------- PLACEHOLDER ---------- */
  'linkscore-alt': 'mapbox://styles/bmen/cmgcap1iz004g01re8jyr5e6c'/* ---------- FINAL ---------- */
};

const customLegends = {
  "choropleth-existing": `<div id="legend-title">Relative Access</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),#ffffb3,rgb(0,194,0));"></div>
    <div class="legend-labels"><span>0%</span><span>50%</span><span>100%</span></div>`,
  "choropleth-improvements": `<div id="legend-title">Percent Access</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),#ffffb3,rgb(0,194,0));"></div>
    <div class="legend-labels"><span>0%</span><span>50%</span><span>100%</span></div>`,
  "choropleth-change": `<div id="legend-title">Change in Access</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),rgb(255,243,173),rgb(0,194,0));"></div>
    <div class="legend-labels"><span>-100%</span><span>0%</span><span>100%</span></div>`,
  "weighting-existing": `<div id="legend-title"> Relative Weighting</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),#ffffb3,rgb(0,194,0));"></div>
    <div class="legend-labels"><span>0%</span><span>50%</span><span>100%</span></div>`,
  "weighting-improvements": `<div id="legend-title">Relative Weighting</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),#ffffb3,rgb(0,194,0));"></div>
    <div class="legend-labels"><span>0%</span><span>50%</span><span>100%</span></div>`,
  "weighting-change": `<div id="legend-title">Weighting Improvement from Changes</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(192,232,188),rgb(24,170,82));"></div>
    <div class="legend-labels"><span>+0%</span><span></span><span>+100%</span></div>`,
  "unfactored": `<div id="legend-title">Percent Importance</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),#ffffb3,rgb(0,194,0));"></div>
    <div class="legend-labels"><span>0%</span><span>50%</span><span>100%</span></div>`,
  "factored": `<div id="legend-title">Percent Importance</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),#ffffb3,rgb(0,194,0));"></div>
    <div class="legend-labels"><span>-100%</span><span>0%</span><span>100%</span></div>`,
  "difference": `<div id="legend-title">Change in Importance</div>
    <div class="gradient-bar" style="background:linear-gradient(to right,rgb(255,13,0),rgb(255,243,173),rgb(0,194,0));"></div>
    <div class="legend-labels"><span>-100%</span><span>0%</span><span>100%</span></div>`,
  "linkscore-alt": `<div id="legend-title"></div>
    <div style="margin-top:0px;font-size:10px;">
    </div>`
};

const descriptions = {
  importance: "<b>Importance of Link in Cycling Network</b> quantifies how frequently a link (segment of street or path) is on a shortest path, and therefore how important of a role it plays in providing connectivity for the whole network.",
  access: "<b>Access to ideal trip options</b> quantifies the average ease to which a rider within a given area can access a direct and quality (comfortable to ride on) bike path.",
  weighting: "Each link (segment of street or path) has been <b>weighted based on it's attributes</b>. These include <b>fixed</b> attributes such as slope, and <b>unfixed</b> attributes such as degree of bike lane protected-ness. The weighting is applied to each link to quantify the effects of positive and negative attributes within the shortest path algorithm. This is to gain a better measure of connectivity from the algorithm.",
  riderTypes: `Different Cyclists feel only feel <b>comfortable cycling in particular environements</b>. The range that a cyclists is willing to go is mapped based on their <b>level of confidence</b>. These 4 levels are:<br>
1. <u>Strong and Fearless</u> (4% of people): willing to bicycle under any traffic conditions,<br>
2. <u>Enthused and Confident</u> (9% of people): comfortable with minimal bicycle accommodations,<br>
3. <u>Interested but Concerned</u> (56% of people): uncomfortable with high vehicle speeds and volume,<br>
4. <u>No Way No How</u> (31% of people): not interested in bicycling.`
};

const riderLayers = {
  strong: 'rider_strong',
  confident: 'rider_confident',
  concerned: 'rider_concerned',
  noway: 'rider_noway'
};

const map = new mapboxgl.Map({
  container: 'map',
  style: styles['factored'],
  center: [144.9631, -37.8136],
  zoom: 12.5
});
map.addControl(new mapboxgl.NavigationControl({ visualizePitch: true }), 'top-right');
map.addControl(new mapboxgl.ScaleControl({ maxWidth: 200, unit: 'metric' }), 'bottom-right');

function renderLegend(key){ document.getElementById('legend').innerHTML = customLegends[key] || ""; }
function renderDescription(group){ document.getElementById('description-box').innerHTML = `<strong>About:</strong> ${descriptions[group]||''}`; }

function setMapStyleByKey(key){
  if(!styles[key])return;
  map.setStyle(styles[key]);
  map.once('styledata',()=>{ renderLegend(key); if(key==='linkscore-alt') attachRiderToggles(); });
}
function attachRiderToggles(){
  document.querySelectorAll('input[name="riderType"]').forEach(cb=>{
    cb.addEventListener('change',e=>{
      const id=e.target.value;
      if(map.getLayer(id)) map.setLayoutProperty(id,'visibility',e.target.checked?'visible':'none');
    });
    const id=cb.value;
    if(map.getLayer(id)) map.setLayoutProperty(id,'visibility',cb.checked?'visible':'none');
  });
}
function showSubpanel(g){
  document.querySelectorAll('.suboptions').forEach(s=>s.style.display='none');
  if(g==='importance')document.getElementById('betweenness-suboptions').style.display='block';
  if(g==='access')document.getElementById('choropleth-suboptions').style.display='block';
  if(g==='weighting')document.getElementById('weighting-suboptions').style.display='block';
  if(g==='riderTypes')document.getElementById('rider-suboptions').style.display='block';
}
document.querySelectorAll('input[name="layer-group"]').forEach(r=>{
  r.addEventListener('change',e=>{
    const g=e.target.value;
    showSubpanel(g);
    renderDescription(g);
    if(g==='importance')setMapStyleByKey(document.querySelector("input[name='betweenness-sub']:checked").id);
    if(g==='access')setMapStyleByKey(document.querySelector("input[name='choropleth-sub']:checked").id);
    if(g==='weighting')setMapStyleByKey(document.querySelector("input[name='weighting-sub']:checked").id);
    if(g==='riderTypes')setMapStyleByKey('linkscore-alt');
  });
});
document.querySelectorAll("input[name='betweenness-sub'],input[name='choropleth-sub'],input[name='weighting-sub']")
  .forEach(r=>r.addEventListener('change',()=>setMapStyleByKey(r.id)));

map.once('styledata',()=>renderLegend('factored'));
renderDescription('importance');
showSubpanel('importance');

/* ---------- MOBILE MENU TOGGLE ---------- */
const menuBtn=document.getElementById('menu-button');
const overlay=document.getElementById('map-overlay');
const icon=menuBtn.querySelector('.menu-icon');
const text=menuBtn.querySelector('.menu-text');
menuBtn.addEventListener('click',()=>{
  overlay.classList.toggle('open');
  const isOpen=overlay.classList.contains('open');
  icon.classList.toggle('active',isOpen);
  text.textContent=isOpen?'Close':'Menu';
});
</script>
</body>
</html>
